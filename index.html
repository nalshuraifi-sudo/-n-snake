<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>N-Snake v4.0 â€“ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050b18;
      --panel: #0b1221;
      --border: #16c784;
      --accent: #16c784;
      --accent-soft: rgba(22, 199, 132, 0.12);
      --danger: #ff6b6b;
      --text: #f5f7ff;
      --muted: #9ba4c4;
      --gold: #ffd54a;
      --gold-soft: rgba(255, 213, 74, 0.25);
      --btn: #0f192d;
      --btn-border: #263654;
      --dpad: #1e90ff;
      --dpad-glow: rgba(30, 144, 255, 0.45);
      --grid-line: rgba(255, 255, 255, 0.03);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      padding: 16px;
      background: radial-gradient(circle at top, #071329 0, #020612 55%, #000 100%);
      color: var(--text);
      display: flex;
      justify-content: center;
    }

    .page {
      width: 100%;
      max-width: 640px;
    }

    .card {
      background: linear-gradient(135deg, #050a17 0, #070f20 60%, #050a18 100%);
      border-radius: 18px;
      padding: 16px 18px 18px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.75);
      margin-bottom: 14px;
    }

    .header-logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .snake-logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fff7d0 0, #ffea8a 26%, #ffd54a 46%, #c49a19 70%, #8b5b08 100%);
      box-shadow:
        0 0 25px rgba(255, 213, 74, 0.9),
        0 0 60px rgba(255, 213, 74, 0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 46px;
    }

    .title-main {
      font-weight: 800;
      font-size: 20px;
      text-align: center;
    }

    .title-sub {
      text-align: center;
      font-size: 13px;
      color: var(--muted);
    }

    .badge-version {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 11px;
      background: rgba(5, 14, 32, 0.9);
      margin-top: 4px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .stat-box {
      background: radial-gradient(circle at top, rgba(22, 199, 132, 0.06), rgba(8, 16, 32, 0.9));
      border-radius: 14px;
      padding: 7px 10px;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .stat-label {
      color: var(--muted);
      font-size: 11px;
      margin-bottom: 2px;
    }

    .stat-value {
      font-weight: 700;
      font-size: 13px;
    }

    .stat-highlight {
      color: var(--gold);
    }

    .speed-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 6px;
      font-size: 12px;
    }

    select,
    input {
      background: #050b18;
      border-radius: 999px;
      border: 1px solid var(--btn-border);
      color: var(--text);
      padding: 6px 10px;
      font-size: 12px;
      outline: none;
      width: 100%;
    }

    select:focus,
    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(22, 199, 132, 0.5);
    }

    .label-small {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .player-grid {
      display: grid;
      gap: 10px;
      margin-top: 4px;
    }

    .player-inline {
      display: flex;
      gap: 6px;
    }

    .player-inline > * {
      flex: 1;
    }

    .player-data {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .leaderboard {
      margin-top: 8px;
      font-size: 12px;
    }

    .leaderboard-row {
      display: flex;
      justify-content: space-between;
      padding: 3px 0;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.04);
    }

    .leaderboard-row span:first-child {
      max-width: 60%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .leaderboard-row span:last-child {
      color: var(--gold);
      font-weight: 600;
    }

    .game-wrapper {
      border-radius: 18px;
      padding: 10px;
      border: 1px solid rgba(22, 199, 132, 0.4);
      background: radial-gradient(circle at top, rgba(22, 199, 132, 0.08), rgba(4, 8, 18, 0.95));
      margin-bottom: 14px;
    }

    .game-area {
      position: relative;
      width: 100%;
      padding-bottom: 100%;
      border-radius: 14px;
      border: 1px solid rgba(22, 199, 132, 0.6);
      overflow: hidden;
      background:
        linear-gradient(#020712, #020510),
        repeating-linear-gradient(
          to right,
          var(--grid-line),
          var(--grid-line) 1px,
          transparent 1px,
          transparent 16px
        ),
        repeating-linear-gradient(
          to bottom,
          var(--grid-line),
          var(--grid-line) 1px,
          transparent 1px,
          transparent 16px
        );
    }

    canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .game-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .game-overlay.hidden {
      display: none;
    }

    .game-message {
      pointer-events: auto;
      background: rgba(3, 8, 18, 0.97);
      border-radius: 18px;
      padding: 14px 16px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      width: 92%;
      max-width: 360px;
      text-align: center;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
      font-size: 13px;
    }

    .game-message h3 {
      margin: 0 0 6px;
      color: #ffb347;
      font-size: 15px;
    }

    .game-message p {
      margin: 2px 0;
      color: var(--muted);
      line-height: 1.6;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--btn-border);
      background: var(--btn);
      color: var(--text);
      padding: 7px 14px;
      font-size: 13px;
      cursor: pointer;
      min-width: 110px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: radial-gradient(circle at top, #19d78f, #0b8f58);
      border-color: rgba(25, 215, 143, 0.9);
      box-shadow:
        0 0 18px rgba(25, 215, 143, 0.7),
        0 10px 24px rgba(0, 0, 0, 0.8);
      font-weight: 600;
    }

    .btn-ghost {
      background: transparent;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .controls-card {
      margin-top: 10px;
      display: grid;
      gap: 10px;
    }

    .top-controls {
      display: flex;
      gap: 8px;
      justify-content: space-between;
    }

    .top-controls .btn {
      flex: 1;
      font-size: 12px;
      padding-block: 6px;
    }

    .dpad-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 12px;
    }

    .dpad {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
    }

    .dpad-middle {
      display: flex;
      gap: 72px;
    }

    .dpad-btn {
      width: 78px;
      height: 78px;
      border-radius: 22px;
      border: none;
      background: radial-gradient(circle at top, #4cc2ff, var(--dpad));
      box-shadow:
        0 0 26px var(--dpad-glow),
        0 12px 30px rgba(0, 0, 0, 0.9);
      color: #ffffff;
      font-size: 28px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      outline: none;
      touch-action: manipulation;
    }

    .dpad-btn:active {
      transform: translateY(2px) scale(0.96);
      box-shadow:
        0 0 12px var(--dpad-glow),
        0 4px 18px rgba(0, 0, 0, 0.9);
    }

    footer {
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
    }

    .gold-victory {
      animation: goldPulse 1.2s infinite alternate;
      box-shadow:
        0 0 22px rgba(255, 213, 74, 0.9),
        0 0 80px rgba(255, 213, 74, 0.5);
    }

    @keyframes goldPulse {
      from {
        border-color: rgba(255, 213, 74, 0.7);
      }
      to {
        border-color: rgba(255, 255, 255, 0.95);
      }
    }

    @media (max-width: 480px) {
      .dpad-middle {
        gap: 38px;
      }
      .dpad-btn {
        width: 72px;
        height: 72px;
        border-radius: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© -->
    <div class="card">
      <div class="header-logo">
        <div class="snake-logo">ğŸ</div>
        <div class="title-main">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ© â€“ N-Snake v4.0</div>
        <div class="title-sub">
          Ù†Ø³Ø®Ø© Ù…Ø·ÙˆÙ‘Ø±Ø© Ù…Ø®ØµÙ‘ØµØ© Ù„Ù€ <b>Ù†Ø¨ÙŠÙ„ Ø¹Ù„ÙŠ Ø§Ù„Ø´Ø±ÙŠÙÙŠ</b> â€“ Ù†Ø¸Ø§Ù… Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ù„ÙˆØ­Ø© Ø´Ø±ÙØŒ
          ÙˆÙ…Ø³ØªÙˆÙŠØ§Øª Ø­ØªÙ‰ <span class="stat-highlight">10,000</span> Ù†Ù‚Ø·Ø©.
        </div>
        <div class="badge-version">
          <span>Ù†Ø³Ø®Ø© Ù…Ø·ÙˆÙ‘Ø±Ø© â€“ Ù„ÙˆØ­Ø© Ø´Ø±ÙØŒ ÙˆÙ…Ø³ØªÙˆÙŠØ§Øª Ø­ØªÙ‰ 10,000 Ù†Ù‚Ø·Ø©.</span>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-label">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
          <div class="stat-value" id="statPoints">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø© Ù„Ùƒ</div>
          <div class="stat-value stat-highlight" id="statBest">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
          <div class="stat-value" id="statLevel">1</div>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-label">Ù„Ù‚Ø¨Ùƒ</div>
          <div class="stat-value" id="statTitle">Ù…Ø¨ØªØ¯Ø¦</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Ø§Ù„Ø³Ø±Ø¹Ø©</div>
          <div class="stat-value" id="statSpeedLabel">Ø¨Ø·ÙŠØ¦Ø© Ø¬Ø¯Ù‹Ø§ (Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†)</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</div>
          <div class="stat-value" id="statGames">0</div>
        </div>
      </div>

      <div class="speed-row">
        <span class="label-small">ØªØºÙŠÙŠØ± Ø³Ø±Ø¹Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©:</span>
        <select id="speedSelect">
          <option value="0">Ø¨Ø·ÙŠØ¦Ø© Ø¬Ø¯Ù‹Ø§ (Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†)</option>
          <option value="1">Ø¨Ø·ÙŠØ¦Ø©</option>
          <option value="2">Ù…ØªÙˆØ³Ø·Ø©</option>
          <option value="3">Ø³Ø±ÙŠØ¹Ø©</option>
          <option value="4">Ø³Ø±ÙŠØ¹Ø© Ø¬Ø¯Ù‹Ø§</option>
        </select>
      </div>
    </div>

    <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <div class="card">
      <div class="player-grid">
        <div>
          <div class="label-small">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø³ØªØ¸Ù‡Ø± Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§):</div>
          <input id="playerNameInput" list="playersList" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
          <datalist id="playersList"></datalist>
        </div>

        <div class="player-inline">
          <button class="btn btn-primary" id="btnSetPlayer">ØªØ¹ÙŠÙŠÙ† / Ø­ÙØ¸ Ø§Ù„Ù„Ø§Ø¹Ø¨</button>
          <button class="btn btn-ghost" id="btnClearPlayers">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ù…Ø­Ù„ÙŠÙ‹Ø§)</button>
        </div>

        <div>
          <div class="label-small">âœ… Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…Ù…ÙŠÙ‘Ø²ÙˆÙ† (ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©):</div>
          <select id="featuredPlayersSelect">
            <option value="">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ù‹Ø§ Ù„Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡ Ø£Ùˆ Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø§Ø³Ù…Ù‡â€¦</option>
          </select>
        </div>

        <div class="player-data" id="currentPlayerInfo">
          Ø§Ù„Ø§Ø³Ù…: â€” <br>
          Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©: 0 <br>
          Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª: 0
        </div>

        <div class="leaderboard">
          <div class="label-small">Ø£ÙØ¶Ù„ 5 Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù):</div>
          <div id="leaderboardList"></div>
        </div>
      </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
    <div class="game-wrapper" id="gameWrapper">
      <div class="game-area">
        <canvas id="gameCanvas"></canvas>
        <div class="game-overlay" id="overlay">
          <div class="game-message" id="overlayMessage">
            <h3>Ø§Ø¶ØºØ· "Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ù„Ø¨Ø¯Ø¡ ğŸ®</h3>
            <p>
              Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†ØŒ ÙˆØ§Ø¬Ù…Ø¹ Ø£ÙƒØ¨Ø± Ù‚Ø¯Ø± Ù…Ù…ÙƒÙ† Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø·ØŒ
              ÙˆØªØ¯Ø±Ù‘Ø¬ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø­ØªÙ‰ ØªØµÙ„ Ø¥Ù„Ù‰ <span class="stat-highlight">10,000 Ù†Ù‚Ø·Ø©</span> â€“ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø©.
            </p>
            <div class="btn-row">
              <button class="btn btn-primary" id="btnStartGame">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div>
          </div>
        </div>
      </div>

      <div class="controls-card">
        <div class="top-controls">
          <button class="btn" id="btnPauseResume">Ø¥ÙŠÙ‚Ø§Ù / Ø§Ø³ØªØ¦Ù†Ø§Ù</button>
          <button class="btn" id="btnShareScore">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
        </div>

        <div class="dpad-wrapper">
          <div class="dpad">
            <button class="dpad-btn" id="btnUp">â†‘</button>
            <div class="dpad-middle">
              <!-- Ø§Ù„Ø²Ø± Ø§Ù„Ø¸Ø§Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ø¨ØµØ±ÙŠÙ‹Ø§ -->
              <button class="dpad-btn" id="btnLeft">â†</button>
              <!-- Ø§Ù„Ø²Ø± Ø§Ù„Ø¸Ø§Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¨ØµØ±ÙŠÙ‹Ø§ -->
              <button class="dpad-btn" id="btnRight">â†’</button>
            </div>
            <button class="dpad-btn" id="btnDown">â†“</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      ØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© ØªÙƒØ±ÙŠÙ…Ù‹Ø§ Ù„Ù„Ù…Ø¨Ø¯Ø¹ <b>Ù†Ø¨ÙŠÙ„ Ø¹Ù„ÙŠ Ø§Ù„Ø´Ø±ÙŠÙÙŠ</b>ØŒ Ù…Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ©ØŒ
      Ù†Ø¸Ø§Ù… Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ø£ØµÙˆØ§Øª Ù…Ø¯Ù…Ø¬Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ØŒ ÙˆØ­ÙØ¸ Ù„Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø­ØªÙ‰ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø®Ø©.
    </footer>
  </div>

  <!-- Ø£ØµÙˆØ§Øª Ø¨ØµÙŠØºØ© Base64 Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ -->
  <audio id="sndEat" preload="auto"></audio>
  <audio id="sndGameOver" preload="auto"></audio>

  <script>
    /**********************
     * Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ØµÙˆØ§Øª Base64
     **********************/
    const eatData =
      "UklGRqgVAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YYAVAACAgICAv7+/v7y8vLy6urq6urq7u7u7u7u7vLy8vL6+vr6+vr29vb29vb7+/v7+/v9/f39/f39/f7+/v7+/v39/f39/f3+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+/v39/f39/f7+/v7+";
    const overData =
      "UklGRkZWAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YSJWAAAAAKUDRwfjCnYO/RF1FdsYbCB1IYwobC7dMEs6aU8CbVUkd2aHd3W2gHluir6yusK6g7z2wbcHnWg0xnbHeEfYePgnaJk4mdjJuZn5ugobOhr5Suk7CppKmlqaeqpbGsrrqyuLC4s7u2uLq2tL2ztbKxs7m1uLe4u7m6u7i7u7y8vL29v76+vr+/wA==";

    document.getElementById("sndEat").src =
      "data:audio/wav;base64," + eatData;
    document.getElementById("sndGameOver").src =
      "data:audio/wav;base64," + overData;

    /**********************
     * Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù„Ø¹Ø¨Ø©
     **********************/
    const STORAGE_KEY = "nsnake_players"; // Ø«Ø§Ø¨Øª Ø¨ÙŠÙ† Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª
    const MAX_SCORE = 10000;

    const speedLevels = [
      { label: "Ø¨Ø·ÙŠØ¦Ø© Ø¬Ø¯Ù‹Ø§ (Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†)", interval: 260 },
      { label: "Ø¨Ø·ÙŠØ¦Ø©", interval: 210 },
      { label: "Ù…ØªÙˆØ³Ø·Ø©", interval: 170 },
      { label: "Ø³Ø±ÙŠØ¹Ø©", interval: 130 },
      { label: "Ø³Ø±ÙŠØ¹Ø© Ø¬Ø¯Ù‹Ø§", interval: 95 },
    ];

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let gridSize = 21;
    let cellSize = 16;
    let snake = [];
    let direction = { x: 1, y: 0 };
    let nextDirection = { x: 1, y: 0 };

    // Ø§Ù„Ø£ÙƒÙ„: Ù…ÙˆÙ‚Ø¹ + Ù†ÙˆØ¹
    let food = { x: 10, y: 10, type: "normal" };

    let score = 0;
    let level = 1;
    let currentSpeedIndex = 0;
    let loopId = null;
    let isRunning = false;
    let isPaused = false;
    let players = [];
    let currentPlayer = null;

    const overlay = document.getElementById("overlay");
    const overlayMessage = document.getElementById("overlayMessage");
    const gameWrapper = document.getElementById("gameWrapper");

    const statPoints = document.getElementById("statPoints");
    const statBest = document.getElementById("statBest");
    const statLevel = document.getElementById("statLevel");
    const statGames = document.getElementById("statGames");
    const statTitle = document.getElementById("statTitle");
    const statSpeedLabel = document.getElementById("statSpeedLabel");

    const playerNameInput = document.getElementById("playerNameInput");
    const playersList = document.getElementById("playersList");
    const currentPlayerInfo = document.getElementById("currentPlayerInfo");
    const leaderboardList = document.getElementById("leaderboardList");
    const featuredPlayersSelect = document.getElementById(
      "featuredPlayersSelect"
    );

    const sndEat = document.getElementById("sndEat");
    const sndGameOver = document.getElementById("sndGameOver");

    function resizeCanvas() {
      const rect = document
        .querySelector(".game-area")
        .getBoundingClientRect();
      const size = Math.floor(rect.width);
      canvas.width = size;
      canvas.height = size;
      cellSize = size / gridSize;
      draw();
    }

    window.addEventListener("resize", resizeCanvas);

    function defaultPlayersData() {
      return { players: [] };
    }

    function loadPlayers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return defaultPlayersData();
        const parsed = JSON.parse(raw);
        if (!parsed.players) return defaultPlayersData();
        return parsed;
      } catch (e) {
        return defaultPlayersData();
      }
    }

    function savePlayers() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ players }));
    }

    function getOrCreatePlayer(name) {
      name = name.trim();
      if (!name) name = "Ø¶ÙŠÙ";
      let p = players.find((pl) => pl.name === name);
      if (!p) {
        p = {
          name,
          bestScore: 0,
          gamesPlayed: 0,
          createdAt: Date.now(),
          lastPlayedAt: Date.now(),
        };
        players.push(p);
      }
      return p;
    }

    function titleFromBestScore(best) {
      if (best >= 10000) return "Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ø¹Ø´Ø±Ø© Ø¢Ù„Ø§Ù ğŸ‘‘";
      if (best >= 3000) return "Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù„Ø£Ø®Ø¶Ø± ğŸ”¥";
      if (best >= 1500) return "Ø§Ù„ØµÙŠØ§Ø¯ Ø§Ù„Ø³Ø±ÙŠØ¹ âš¡";
      if (best >= 500) return "Ù…Ø­ØªØ±Ù Ù…ØªÙ‚Ø¯Ù… ğŸ¯";
      if (best >= 200) return "Ù…ØºØ§Ù…Ø± Ù†Ø´ÙŠØ· ğŸ’ª";
      return "Ù…Ø¨ØªØ¯Ø¦ ğŸ™‚";
    }

    function updatePlayersUI() {
      // datalist Ù„Ù„Ø£Ø³Ù…Ø§Ø¡
      playersList.innerHTML = "";
      const sorted = [...players].sort(
        (a, b) => b.bestScore - a.bestScore || a.createdAt - b.createdAt
      );
      sorted.forEach((p) => {
        const opt = document.createElement("option");
        opt.value = p.name;
        playersList.appendChild(opt);
      });

      // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© "Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙˆÙ†"
      featuredPlayersSelect.innerHTML = "";
      const firstOpt = document.createElement("option");
      firstOpt.value = "";
      firstOpt.textContent =
        "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ù‹Ø§ Ù„Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡ Ø£Ùˆ Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø§Ø³Ù…Ù‡â€¦";
      featuredPlayersSelect.appendChild(firstOpt);

      sorted.forEach((p, idx) => {
        const opt = document.createElement("option");
        const mark =
          p.bestScore >= 1000 ? "âœ…" : p.bestScore >= 300 ? "â­" : "â€¢";
        opt.value = p.name;
        opt.textContent = `#${idx + 1} ${mark} ${p.name} â€” ${p.bestScore} Ù†Ù‚Ø·Ø©`;
        featuredPlayersSelect.appendChild(opt);
      });

      // Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù
      leaderboardList.innerHTML = "";
      sorted.slice(0, 5).forEach((p, idx) => {
        const row = document.createElement("div");
        row.className = "leaderboard-row";
        const crown = idx === 0 ? "ğŸ‘‘ " : idx === 1 ? "ğŸ¥ˆ " : idx === 2 ? "ğŸ¥‰ " : " ";
        row.innerHTML =
          `<span>${crown}${p.name}</span><span>${p.bestScore}</span>`;
        leaderboardList.appendChild(row);
      });

      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
      if (currentPlayer) {
        currentPlayerInfo.innerHTML =
          `Ø§Ù„Ø§Ø³Ù…: <b>${currentPlayer.name}</b><br>` +
          `Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©: <b>${currentPlayer.bestScore}</b><br>` +
          `Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª: <b>${currentPlayer.gamesPlayed}</b>`;
        statBest.textContent = currentPlayer.bestScore;
        statGames.textContent = currentPlayer.gamesPlayed;
        statTitle.textContent = titleFromBestScore(
          currentPlayer.bestScore
        );
      } else {
        currentPlayerInfo.textContent =
          "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨ Ø¨Ø¹Ø¯. Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ù‹Ø§ØŒ Ø«Ù… Ø§Ø¶ØºØ· Ø²Ø± \"ØªØ¹ÙŠÙŠÙ† / Ø­ÙØ¸ Ø§Ù„Ù„Ø§Ø¹Ø¨\".";
      }
    }

    function setCurrentPlayerByName(name) {
      currentPlayer = getOrCreatePlayer(name);
      currentPlayer.lastPlayedAt = Date.now();
      savePlayers();
      updatePlayersUI();
    }

    document
      .getElementById("btnSetPlayer")
      .addEventListener("click", () => {
        const name = playerNameInput.value.trim() || "Ø¶ÙŠÙ";
        setCurrentPlayerByName(name);
      });

    featuredPlayersSelect.addEventListener("change", (e) => {
      const val = e.target.value;
      if (!val) return;
      playerNameInput.value = val;
      setCurrentPlayerByName(val);
    });

    document
      .getElementById("btnClearPlayers")
      .addEventListener("click", () => {
        if (
          confirm(
            "Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙ‚Ø·. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ"
          )
        ) {
          players = [];
          currentPlayer = null;
          savePlayers();
          updatePlayersUI();
        }
      });

    function resetSnake() {
      snake = [
        { x: 10, y: 10 },
        { x: 9, y: 10 },
        { x: 8, y: 10 },
      ];
      direction = { x: 1, y: 0 };
      nextDirection = { x: 1, y: 0 };
      placeFood();
    }

    // Ø£Ù†ÙˆØ¹ Ø£ÙƒÙ„ Ù…Ø®ØªÙ„ÙØ©
    function randomFoodType() {
      const r = Math.random();
      if (r < 0.75) return "normal";   // Ø£ØºÙ„Ø¨ Ø§Ù„ÙˆÙ‚Øª
      if (r < 0.93) return "bonus";    // Ù†Ø§Ø¯Ø± Ù‚Ù„ÙŠÙ„Ù‹Ø§
      return "mega";                   // Ù†Ø§Ø¯Ø± Ø¬Ø¯Ù‹Ø§
    }

    function placeFood() {
      while (true) {
        const x = Math.floor(Math.random() * gridSize);
        const y = Math.floor(Math.random() * gridSize);
        if (!snake.some((s) => s.x === x && s.y === y)) {
          food = { x, y, type: randomFoodType() };
          return;
        }
      }
    }

    function startGame() {
      if (!currentPlayer) {
        setCurrentPlayerByName(playerNameInput.value || "Ø¶ÙŠÙ";
        );
      }
      score = 0;
      level = 1;
      statPoints.textContent = score;
      statLevel.textContent = level;
      currentSpeedIndex = parseInt(
        document.getElementById("speedSelect").value,
        10
      );
      statSpeedLabel.textContent =
        speedLevels[currentSpeedIndex].label;
      resetSnake();
      isRunning = true;
      isPaused = false;
      overlay.classList.add("hidden");
      gameWrapper.classList.remove("gold-victory");
      if (loopId) clearInterval(loopId);
      loopId = setInterval(
        tick,
        speedLevels[currentSpeedIndex].interval
      );
      draw();
    }

    function pauseResume() {
      if (!isRunning) return;
      isPaused = !isPaused;
      document.getElementById("btnPauseResume").textContent =
        isPaused ? "Ø§Ø³ØªØ¦Ù†Ø§Ù" : "Ø¥ÙŠÙ‚Ø§Ù / Ø§Ø³ØªØ¦Ù†Ø§Ù";
    }

    function endGame(reason) {
      isRunning = false;
      isPaused = false;
      if (loopId) clearInterval(loopId);
      document.getElementById("btnPauseResume").textContent =
        "Ø¥ÙŠÙ‚Ø§Ù / Ø§Ø³ØªØ¦Ù†Ø§Ù";

      // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
      if (currentPlayer) {
        currentPlayer.gamesPlayed += 1;
        if (score > currentPlayer.bestScore) {
          currentPlayer.bestScore = score;
        }
        currentPlayer.lastPlayedAt = Date.now();
        savePlayers();
        updatePlayersUI();
      }

      let msgTitle = "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ğŸ’¥";
      let extra =
        "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø©â€¦ Ù„ÙƒÙ† Ù…Ùˆ Ù†Ù‡Ø§ÙŠØªÙƒ ğŸ‘Œ Ø¬Ø±Ù‘Ø¨ Ù…Ù† Ø¬Ø¯ÙŠØ¯ ÙˆØ­Ù‚Ù‘Ù‚ Ø±Ù‚Ù… Ø£Ù‚ÙˆÙ‰!";
      if (score >= MAX_SCORE) {
        msgTitle = "Ù…Ø¨Ø±ÙˆÙˆÙˆÙˆÙƒ ğŸ‰ğŸ¥³";
        extra =
          "Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ ÙÙŠ Ù„Ø¹Ø¨ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© â€” Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø©! Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ù…Ø¬Ø¯ Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠØµÙ„ Ø¥Ù„ÙŠÙ‡ Ø¥Ù„Ø§ Ø§Ù„Ù†Ø®Ø¨Ø©.";
        gameWrapper.classList.add("gold-victory");
      }

      overlay.classList.remove("hidden");
      overlayMessage.innerHTML =
        `<h3>${msgTitle}</h3>` +
        `<p>${extra}</p>` +
        `<p>Ù†ØªÙŠØ¬ØªÙƒ: <b>${score}</b> â€“ Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø© Ù„Ùƒ: <b>${currentPlayer ? currentPlayer.bestScore : score}</b></p>` +
        `<div class="btn-row"><button class="btn btn-primary" id="btnRestart2">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button></div>`;
      document
        .getElementById("btnRestart2")
        .addEventListener("click", startGame);

      try {
        sndGameOver.currentTime = 0;
        sndGameOver.play().catch(() => {});
      } catch (e) {}
    }

    function tick() {
      if (!isRunning || isPaused) return;

      direction = nextDirection;
      const head = snake[0];
      const newHead = {
        x: head.x + direction.x,
        y: head.y + direction.y,
      };

      // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„Ø¹Ø¨
      if (
        newHead.x < 0 ||
        newHead.y < 0 ||
        newHead.x >= gridSize ||
        newHead.y >= gridSize
      ) {
        endGame("wall");
        return;
      }

      // Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ø¬Ø³Ù…
      if (snake.some((s) => s.x === newHead.x && s.y === newHead.y)) {
        endGame("self");
        return;
      }

      snake.unshift(newHead);

      if (newHead.x === food.x && newHead.y === food.y) {
        // Ø£ÙƒÙ„ Ø§Ù„Ø·Ø¹Ø§Ù… Ø¨Ø£Ù†ÙˆØ§Ø¹Ù‡
        let add = 10;
        if (food.type === "bonus") add = 25;
        else if (food.type === "mega") add = 40;
        score += add;
        if (score > MAX_SCORE) score = MAX_SCORE;

        statPoints.textContent = score;
        level = Math.floor(score / 100) + 1;
        statLevel.textContent = level;
        placeFood();

        try {
          sndEat.currentTime = 0;
          sndEat.play().catch(() => {});
        } catch (e) {}
      } else {
        snake.pop();
      }

      draw();
    }

    function drawFood() {
      const fx = (food.x + 0.5) * cellSize;
      const fy = (food.y + 0.5) * cellSize;
      const r = cellSize * 0.36;

      if (food.type === "normal") {
        // Ù…Ø«Ù„Ø« (Ø¬Ø¨Ù†Ø©)
        ctx.fillStyle = "#ffb347";
        ctx.beginPath();
        ctx.moveTo(fx + r, fy);
        for (let i = 1; i <= 2; i++) {
          const angle = (i * 2 * Math.PI) / 3;
          ctx.lineTo(
            fx + r * Math.cos(angle),
            fy + r * Math.sin(angle)
          );
        }
        ctx.closePath();
        ctx.fill();
      } else if (food.type === "bonus") {
        // Ø¯Ø§Ø¦Ø±Ø© Ø®Ø¶Ø±Ø§Ø¡
        ctx.fillStyle = "#4dff88";
        ctx.beginPath();
        ctx.arc(fx, fy, r, 0, Math.PI * 2);
        ctx.fill();
      } else {
        // Ù†Ø¬Ù…Ø© Ø°Ù‡Ø¨ÙŠØ©
        ctx.fillStyle = "#ffd54a";
        ctx.beginPath();
        for (let i = 0; i < 10; i++) {
          const angle = (i * Math.PI) / 5;
          const rad = i % 2 === 0 ? r : r * 0.45;
          ctx.lineTo(
            fx + rad * Math.cos(angle),
            fy + rad * Math.sin(angle)
          );
        }
        ctx.closePath();
        ctx.fill();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Ø§Ù„Ø·Ø¹Ø§Ù…
      drawFood();

      // Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†
      snake.forEach((seg, idx) => {
        const x = seg.x * cellSize;
        const y = seg.y * cellSize;
        const isHead = idx === 0;
        const radius = cellSize * 0.4;

        const grad = ctx.createRadialGradient(
          x + cellSize * 0.3,
          y + cellSize * 0.3,
          cellSize * 0.1,
          x + cellSize * 0.5,
          y + cellSize * 0.5,
          radius
        );
        grad.addColorStop(0, isHead ? "#9dffb8" : "#44ff99");
        grad.addColorStop(1, isHead ? "#0aa95a" : "#087f3f");
        ctx.fillStyle = grad;
        ctx.beginPath();
        if (ctx.roundRect) {
          ctx.roundRect(
            x + cellSize * 0.1,
            y + cellSize * 0.1,
            cellSize * 0.8,
            cellSize * 0.8,
            cellSize * 0.3
          );
        } else {
          ctx.rect(
            x + cellSize * 0.1,
            y + cellSize * 0.1,
            cellSize * 0.8,
            cellSize * 0.8
          );
        }
        ctx.fill();

        if (isHead) {
          // Ø§Ù„Ø¹ÙŠÙ†
          const eyeR = cellSize * 0.12;
          const eyeX =
            x +
            cellSize * 0.5 +
            (direction.x === 1
              ? cellSize * 0.12
              : direction.x === -1
              ? -cellSize * 0.12
              : 0);
          const eyeY =
            y +
            cellSize * 0.35 +
            (direction.y === 1
              ? cellSize * 0.1
              : direction.y === -1
              ? -cellSize * 0.1
              : 0);
          ctx.fillStyle = "#00110a";
          ctx.beginPath();
          ctx.arc(eyeX, eyeY, eyeR, 0, Math.PI * 2);
          ctx.fill();
          ctx.fillStyle = "#9dffb8";
          ctx.beginPath();
          ctx.arc(
            eyeX + eyeR * 0.3,
            eyeY - eyeR * 0.1,
            eyeR * 0.4,
            0,
            Math.PI * 2
          );
          ctx.fill();
        }
      });
    }

    /**********************
     * ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø³Ù‡Ù…
     **********************/
    function setDirection(dx, dy) {
      if (!isRunning) return;
      // Ù…Ù†Ø¹ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©
      if (dx === -direction.x && dy === -direction.y) return;
      nextDirection = { x: dx, y: dy };
    }

    function attachDir(btn, dx, dy) {
      ["click", "touchstart"].forEach((ev) => {
        btn.addEventListener(ev, (e) => {
          e.preventDefault();
          setDirection(dx, dy);
        });
      });
    }

    // Ù‡Ù†Ø§ Ù‚Ù„Ø¨Ù†Ø§ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ÙŠÙ† Ø¹Ù…Ø¯Ø§Ù‹ Ù„ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø¹Ù†Ø¯Ùƒ:
    const btnUp = document.getElementById("btnUp");
    const btnDown = document.getElementById("btnDown");
    const btnLeft = document.getElementById("btnLeft");
    const btnRight = document.getElementById("btnRight");

    attachDir(btnUp, 0, -1);
    attachDir(btnDown, 0, 1);

    // Ø§Ù„Ø²Ø± Ø§Ù„Ø¸Ø§Ù‡Ø± Ø¹Ù„Ù‰ "Ø§Ù„ÙŠØ³Ø§Ø±" Ø¨ØµØ±ÙŠØ§Ù‹ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† ÙŠØ°Ù‡Ø¨ ÙŠÙ…ÙŠÙ†Ù‹Ø§
    attachDir(btnLeft, 1, 0);
    // Ø§Ù„Ø²Ø± Ø§Ù„Ø¸Ø§Ù‡Ø± Ø¹Ù„Ù‰ "Ø§Ù„ÙŠÙ…ÙŠÙ†" Ø¨ØµØ±ÙŠØ§Ù‹ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† ÙŠØ°Ù‡Ø¨ ÙŠØ³Ø§Ø±Ù‹Ø§
    attachDir(btnRight, -1, 0);

    window.addEventListener("keydown", (e) => {
      switch (e.key) {
        case "ArrowUp":
          setDirection(0, -1);
          break;
        case "ArrowDown":
          setDirection(0, 1);
          break;
        case "ArrowLeft":
          setDirection(-1, 0);
          break;
        case "ArrowRight":
          setDirection(1, 0);
          break;
      }
    });

    document
      .getElementById("btnPauseResume")
      .addEventListener("click", pauseResume);

    document
      .getElementById("btnStartGame")
      .addEventListener("click", startGame);

    document
      .getElementById("btnShareScore")
      .addEventListener("click", () => {
        const name = currentPlayer ? currentPlayer.name : "Ù„Ø§Ø¹Ø¨";
        const text = `Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ© â€“ N-Snake ğŸ®\nØ§Ù„Ù„Ø§Ø¹Ø¨: ${name}\nÙ†ØªÙŠØ¬ØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${score} Ù†Ù‚Ø·Ø©\nØ£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø© Ù„ÙŠ: ${
          currentPlayer ? currentPlayer.bestScore : score
        } Ù†Ù‚Ø·Ø©.\n\nØ±Ø§Ø¨Ø· Ø§Ù„Ù„Ø¹Ø¨Ø©: ${location.href}`;
        if (navigator.share) {
          navigator
            .share({ text })
            .catch(() => {});
        } else {
          navigator.clipboard
            .writeText(text)
            .then(() =>
              alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø© â€“ ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚Ù‡Ø§ ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù†.")
            )
            .catch(() =>
              alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù†ØµÙŠÙ‹Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§.")
            );
        }
      });

    document
      .getElementById("speedSelect")
      .addEventListener("change", (e) => {
        currentSpeedIndex = parseInt(e.target.value, 10);
        statSpeedLabel.textContent =
          speedLevels[currentSpeedIndex].label;
        if (isRunning && !isPaused) {
          if (loopId) clearInterval(loopId);
          loopId = setInterval(
            tick,
            speedLevels[currentSpeedIndex].interval
          );
        }
      });

    // ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ©
    function init() {
      resizeCanvas();
      const data = loadPlayers();
      players = data.players || [];
      if (players.length > 0) {
        // Ø§Ø®ØªÙŠØ§Ø± Ø¢Ø®Ø± Ù„Ø§Ø¹Ø¨ Ù„Ø¹Ø¨
        players.sort(
          (a, b) => (b.lastPlayedAt || 0) - (a.lastPlayedAt || 0)
        );
        currentPlayer = players[0];
        playerNameInput.value = currentPlayer.name;
      }
      updatePlayersUI();
      statSpeedLabel.textContent = speedLevels[0].label;
      draw();
    }

    init();
  </script>
</body>
</html>
